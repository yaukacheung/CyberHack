# Part F: Customization, Extension & Hardening

## Objective
The goal of this final stage is to transition from following guided scenarios to actively modifying the ecosystem. You will extend functionality by adding new sensor types, create custom attack scripts, and harden the system against advanced threats.

> [!CAUTION]
> **Discussion Point:** Why is "extensibility" considered both a critical feature and a massive security risk in smart home ecosystems? How do you allow third-party developers to add new devices without unintentionally opening catastrophic attack vectors?

---

## üèóÔ∏è 1. Adding New Hardware (Extension)
The system currently tracks `temp` (temperature). You will extend the schema to simultaneously track `humidity` and `voltage`.

### Step 1: Update the Simulator Model
Open `rpi_simulator/sensor.js` and modify the payload generated by the mock hardware:
```javascript
const payload = {
  deviceId: DEVICE_ID,
  temp: (Math.random() * 30 + 10).toFixed(2),
  humidity: (Math.random() * 50 + 30).toFixed(2), // New telemetry
  voltage: (Math.random() * 5 + 215).toFixed(2),  // New telemetry
  timestamp: new Date().toISOString()
};
```

### Step 2: Update the API & Database Schema
In `server/models/Reading.js` (if strictly typed) or within the `server/index.js` data processing logic, ensure the new fields are explicitly expected, validated, and stored.

---

## üî¥ 2. Creating Custom Attacks (Purple Teaming)
Modify `rpi_simulator/malicious_node.js` to simulate complex threats beyond simple floods.

- **Data Manipulation (Oscillating Attack):** Instead of static high numbers, write a script that sends values oscillating *just below* the Blue Team's alarm threshold (e.g., if the alarm is > 50¬∞C, send 49.5, 49.8, 49.2). This tests if the defense can detect subtle anomalies over time.
- **Protocol Fuzzing:** Send malformed JSON, corrupted strings, or massive payloads (e.g., a 10MB string) to the `/api/readings` endpoint to test the Node.js server's unhandled exception management and stability.

---

## üîµ 3. Dashboard Customization
The Blue Team Dashboard is built with React and heavily relies on visual cues. 
- **New Visualization:** Add a new `LineChart` component in `client/src/app` to track the newly added `voltage` data.
- **CSS Threat Indicators:** Modify the global CSS so that if the new `voltage` drops below `210V`, the entire dashboard border turns yellow, indicating a potential "Brownout DoS" attack on the hardware.

---

## üõ°Ô∏è 4. Hardening the Defense
Implement professional-grade mitigations referencing Chapter 10 of your textbook:

- **Strict Schema Enforcement:** Use a library like `Zod` or `Joi` in Express.js. Reject *any* POST request that includes fields not explicitly defined in your schema, mitigating Prototype Pollution and NoSQL injection.
- **Data Encryption in Transit:** Use a tool like `ngrok` or generate self-signed certificates with `OpenSSL` to proxy the simulator traffic through an encrypted HTTPS/SSL tunnel, defeating network packet sniffing (Wireshark).
